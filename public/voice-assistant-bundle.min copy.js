/*! Voice Assistant Bundle - Minified Version */
!function(t){"use strict";const e={base64ToArrayBuffer(t){const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n.buffer},arrayBufferToBase64(t){let e="";const n=new Uint8Array(t),i=n.byteLength;for(let t=0;t<i;t++)e+=String.fromCharCode(n[t]);return btoa(e)},async audioContext(t={}){const e=new Promise(t=>{const e=()=>{document.removeEventListener("pointerdown",e),document.removeEventListener("keydown",e),document.removeEventListener("click",e),t()};document.addEventListener("pointerdown",e,{once:!0}),document.addEventListener("keydown",e,{once:!0}),document.addEventListener("click",e,{once:!0})});try{const e=new Audio;return e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",await e.play(),new AudioContext(t)}catch(n){return await e,new AudioContext(t)}},createWorkletFromSrc(t,e){const n=new Blob([`registerProcessor("${t}", ${e})`],{type:"application/javascript"});return URL.createObjectURL(n)}};class EventEmitter{constructor(){this.events={}}on(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),this}off(t,e){return this.events[t]?(this.events[t]=this.events[t].filter(t=>t!==e),this):this}emit(t,...e){return!!this.events[t]&&(this.events[t].forEach(t=>t.apply(this,e)),!0)}}const n='\n        class AudioRecordingWorklet extends AudioWorkletProcessor {\n            buffer = new Int16Array(2048);\n            bufferWriteIndex = 0;\n\n            constructor() {\n                super();\n                this.hasAudio = false;\n            }\n\n            process(inputs) {\n                if (inputs[0].length) {\n                    const channel0 = inputs[0][0];\n                    this.processChunk(channel0);\n                }\n                return true;\n            }\n\n            sendAndClearBuffer() {\n                this.port.postMessage({\n                    event: "chunk",\n                    data: {\n                        int16arrayBuffer: this.buffer.slice(0, this.bufferWriteIndex).buffer,\n                    },\n                });\n                this.bufferWriteIndex = 0;\n            }\n\n            processChunk(float32Array) {\n                const l = float32Array.length;\n\n                for (let i = 0; i < l; i++) {\n                    const int16Value = float32Array[i] * 32768;\n                    this.buffer[this.bufferWriteIndex++] = int16Value;\n                    if (this.bufferWriteIndex >= this.buffer.length) {\n                        this.sendAndClearBuffer();\n                    }\n                }\n\n                if (this.bufferWriteIndex >= this.buffer.length) {\n                    this.sendAndClearBuffer();\n                }\n            }\n        }\n    ',i="\n        class VolMeterWorklet extends AudioWorkletProcessor {\n            volume\n            updateIntervalInMS\n            nextUpdateFrame\n\n            constructor() {\n                super()\n                this.volume = 0\n                this.updateIntervalInMS = 25\n                this.nextUpdateFrame = this.updateIntervalInMS\n                this.port.onmessage = event => {\n                    if (event.data.updateIntervalInMS) {\n                        this.updateIntervalInMS = event.data.updateIntervalInMS\n                    }\n                }\n            }\n\n            get intervalInFrames() {\n                return (this.updateIntervalInMS / 1000) * sampleRate\n            }\n\n            process(inputs) {\n                const input = inputs[0]\n\n                if (input.length > 0) {\n                    const samples = input[0]\n                    let sum = 0\n                    let rms = 0\n\n                    for (let i = 0; i < samples.length; ++i) {\n                        sum += samples[i] * samples[i]\n                    }\n\n                    rms = Math.sqrt(sum / samples.length)\n                    this.volume = Math.max(rms, this.volume * 0.7)\n\n                    this.nextUpdateFrame -= samples.length\n                    if (this.nextUpdateFrame < 0) {\n                        this.nextUpdateFrame += this.intervalInFrames\n                        this.port.postMessage({ volume: this.volume })\n                    }\n                }\n\n                return true\n            }\n        }\n    ";class s extends EventEmitter{constructor(t,e=null){super(),this.backendUrl=t,this.apiKey=e,this.ws=null,this._status="disconnected",this._model=null,this.config=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.send=this.send.bind(this)}get status(){return this._status}get model(){return this._model}getConfig(){return{...this.config}}log(t,e){const n={date:new Date,type:t,message:e};this.emit("log",n)}setupWebSocket(){try{let t=this.backendUrl;if(this.apiKey){const e=t.includes("?")?"&":"?";t+=`${e}apiKey=${encodeURIComponent(this.apiKey)}`}this.ws=new WebSocket(t),this.ws.onopen=()=>{console.log("Connected to backend WebSocket"),this._status="connected",this.reconnectAttempts=0,this.emit("open"),this.log("client.open","Connected to backend")},this.ws.onmessage=t=>{try{const e=JSON.parse(t.data);this.handleBackendMessage(e)}catch(t){console.error("Error parsing WebSocket message:",t)}},this.ws.onclose=t=>{console.log("WebSocket connection closed:",t.code,t.reason),this._status="disconnected",this.emit("close",t),this.log("client.close",`Disconnected: ${t.reason||"Connection closed"}`),1e3!==t.code&&this.reconnectAttempts<this.maxReconnectAttempts&&setTimeout(()=>{this.reconnectAttempts++,console.log(`Reconnection attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),this.setupWebSocket()},this.reconnectDelay*this.reconnectAttempts)},this.ws.onerror=t=>{console.error("WebSocket error:",t),this.emit("error",t),this.log("client.error","WebSocket connection error")}}catch(t){console.error("Failed to create WebSocket connection:",t),this._status="disconnected"}}handleBackendMessage(t){switch(t.type){case"connected":this.emit("open");break;case"disconnected":this._status="disconnected",this.emit("close",new CloseEvent("close"));break;case"setupComplete":this.emit("setupcomplete");break;case"content":this.emit("content",t.data);break;case"audio":const n=e.base64ToArrayBuffer(t.data);this.emit("audio",n);break;case"toolCall":this.emit("toolcall",t.data);break;case"toolCallCancellation":this.emit("toolcallcancellation",t.data);break;case"interrupted":this.emit("interrupted");break;case"turnComplete":this.emit("turncomplete");break;case"error":this.emit("error",new ErrorEvent("error",{message:t.message}));break;case"log":this.emit("log",t.data);break;default:console.log("Unknown message type from backend:",t.type)}}sendToBackend(t){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.warn("WebSocket not connected, message not sent:",t)}async connect(t,e){return"connected"!==this._status&&"connecting"!==this._status&&(this._status="connecting",this.config=e,this._model=t,this.setupWebSocket(),new Promise(n=>{const i=()=>{this.sendToBackend({type:"connect",model:t,config:e}),this.off("open",i),n(!0)},s=()=>{this.off("error",s),this.off("open",i),n(!1)};this.on("open",i),this.on("error",s)}))}disconnect(){return"disconnected"!==this._status&&(this.sendToBackend({type:"disconnect"}),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null),this._status="disconnected",this.log("client.close","Disconnected"),!0)}sendRealtimeInput(t){if("connected"!==this._status)return;this.sendToBackend({type:"sendRealtimeInput",data:t});let e=!1,n=!1;for(const i of t)if(i.mimeType.includes("audio")&&(e=!0),i.mimeType.includes("image")&&(n=!0),e&&n)break;const i=e&&n?"audio + video":e?"audio":n?"video":"unknown";this.log("client.realtimeInput",i)}sendToolResponse(t){"connected"===this._status&&t.functionResponses&&t.functionResponses.length&&(this.sendToBackend({type:"sendToolResponse",data:t}),this.log("client.toolResponse",t))}send(t,e=!0){"connected"===this._status&&(this.sendToBackend({type:"send",data:{turns:t,turnComplete:e}}),this.log("client.send",{turns:Array.isArray(t)?t:[t],turnComplete:e}))}}class o extends EventEmitter{constructor(t=16e3){super(),this.sampleRate=t,this.stream=void 0,this.audioContext=void 0,this.source=void 0,this.recording=!1,this.recordingWorklet=void 0,this.vuWorklet=void 0,this.starting=null}async start(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Could not request user media");return this.starting=new Promise(async(t,s)=>{try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=await e.audioContext({sampleRate:this.sampleRate}),this.source=this.audioContext.createMediaStreamSource(this.stream);const s="audio-recorder-worklet",o=e.createWorkletFromSrc(s,n);await this.audioContext.audioWorklet.addModule(o),this.recordingWorklet=new AudioWorkletNode(this.audioContext,s),this.recordingWorklet.port.onmessage=async t=>{const n=t.data.data.int16arrayBuffer;if(n){const t=e.arrayBufferToBase64(n);this.emit("data",t)}},this.source.connect(this.recordingWorklet);const a="vu-meter";await this.audioContext.audioWorklet.addModule(e.createWorkletFromSrc(a,i)),this.vuWorklet=new AudioWorkletNode(this.audioContext,a),this.vuWorklet.port.onmessage=t=>{this.emit("volume",t.data.volume)},this.source.connect(this.vuWorklet),this.recording=!0,t(),this.starting=null}catch(t){s(t)}}),this.starting}stop(){const t=()=>{this.source?.disconnect(),this.stream?.getTracks().forEach(t=>t.stop()),this.stream=void 0,this.recordingWorklet=void 0,this.vuWorklet=void 0,this.recording=!1};this.starting?this.starting.then(t):t()}}class a{constructor(t){this.context=t,this.sampleRate=24e3,this.bufferSize=7680,this.audioQueue=[],this.isPlaying=!1,this.isStreamComplete=!1,this.checkInterval=null,this.scheduledTime=0,this.initialBufferTime=.1,this.gainNode=this.context.createGain(),this.source=this.context.createBufferSource(),this.endOfQueueAudioSource=null,this.gainNode.connect(this.context.destination),this.onComplete=()=>{}}async addWorklet(t,n,i){const s=e.createWorkletFromSrc(t,n);await this.context.audioWorklet.addModule(s);const o=new AudioWorkletNode(this.context,t);return o.port.onmessage=i,o.connect(this.gainNode),o}_processPCM16Chunk(t){const e=new Float32Array(t.length/2),n=new DataView(t.buffer);for(let i=0;i<t.length/2;i++)try{const t=n.getInt16(2*i,!0);e[i]=t/32768}catch(t){console.error(t)}return e}addPCM16(t){this.isStreamComplete=!1;let e=this._processPCM16Chunk(t);for(;e.length>=this.bufferSize;){const t=e.slice(0,this.bufferSize);this.audioQueue.push(t),e=e.slice(this.bufferSize)}e.length>0&&this.audioQueue.push(e),this.isPlaying||(this.isPlaying=!0,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.scheduleNextBuffer())}createAudioBuffer(t){const e=this.context.createBuffer(1,t.length,this.sampleRate);return e.getChannelData(0).set(t),e}scheduleNextBuffer(){for(;this.audioQueue.length>0&&this.scheduledTime<this.context.currentTime+.2;){const t=this.audioQueue.shift(),e=this.createAudioBuffer(t),n=this.context.createBufferSource();0===this.audioQueue.length&&(this.endOfQueueAudioSource&&(this.endOfQueueAudioSource.onended=null),this.endOfQueueAudioSource=n,n.onended=()=>{this.audioQueue.length||this.endOfQueueAudioSource!==n||(this.endOfQueueAudioSource=null,this.onComplete())}),n.buffer=e,n.connect(this.gainNode);const i=Math.max(this.scheduledTime,this.context.currentTime);n.start(i),this.scheduledTime=i+e.duration}if(0===this.audioQueue.length)this.isStreamComplete?(this.isPlaying=!1,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)):this.checkInterval||(this.checkInterval=setInterval(()=>{this.audioQueue.length>0&&this.scheduleNextBuffer()},100));else{const t=1e3*(this.scheduledTime-this.context.currentTime);setTimeout(()=>this.scheduleNextBuffer(),Math.max(0,t-50))}}stop(){this.isPlaying=!1,this.isStreamComplete=!0,this.audioQueue=[],this.scheduledTime=this.context.currentTime,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.1),setTimeout(()=>{this.gainNode.disconnect(),this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)},200)}async resume(){"suspended"===this.context.state&&await this.context.resume(),this.isStreamComplete=!1,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.gainNode.gain.setValueAtTime(1,this.context.currentTime)}complete(){this.isStreamComplete=!0,this.onComplete()}}class r{constructor(t){this.config=t,this.container=null,this.isMinimized=!1,this.isConnected=!1,this.isListening=!1,this.isTalking=!1,this.isPaused=!1,this.volume=0,this.statusText="Ready to start",this.features={video:t.features?.video||!1,screenShare:t.features?.screenShare||!1,fileUpload:t.features?.fileUpload||!1},this.onStartSession=null,this.onStopSession=null,this.onPauseSession=null,this.onToggleVideo=null,this.onToggleScreenShare=null,this.onFileUpload=null,this.init()}init(){this.container=document.createElement("div"),this.container.className=`voice-assistant-container ${this.config.theme} position-${this.config.position}`,this.addStyles(),this.createUI(),document.body.appendChild(this.container),this.setupAudioVisualizer()}addStyles(){if(!document.getElementById("voice-assistant-styles")){const t=document.createElement("style");t.id="voice-assistant-styles",t.textContent="\n      .voice-assistant-container {\n        position: fixed;\n        z-index: 999999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;\n        pointer-events: none;\n        --primary: #6366f1;\n        --primary-dark: #4f46e5;\n        --success: #10b981;\n        --danger: #ef4444;\n        --warning: #f59e0b;\n        --surface: rgba(255, 255, 255, 0.08);\n        --surface-hover: rgba(255, 255, 255, 0.12);\n        --text: #ffffff;\n        --text-muted: rgba(255, 255, 255, 0.7);\n        --border: rgba(255, 255, 255, 0.1);\n        --shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\n        --radius: 16px;\n      }\n\n      .voice-assistant-container * {\n        box-sizing: border-box;\n      }\n\n      .voice-assistant-container.position-bottom-right {\n        bottom: 24px;\n        right: 24px;\n      }\n\n      .voice-assistant-container.position-bottom-left {\n        bottom: 24px;\n        left: 24px;\n      }\n\n      .voice-assistant-container.position-top-right {\n        top: 24px;\n        right: 24px;\n      }\n\n      .voice-assistant-container.position-top-left {\n        top: 24px;\n        left: 24px;\n      }\n\n      .voice-assistant-container.position-center {\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n      }\n\n      .voice-assistant-widget {\n        background: rgba(17, 17, 27, 0.95);\n        backdrop-filter: blur(20px);\n        border-radius: var(--radius);\n        border: 1px solid var(--border);\n        box-shadow: var(--shadow);\n        padding: 20px;\n        width: 320px;\n        pointer-events: auto;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n\n      .voice-assistant-widget:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);\n      }\n\n      .widget-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 20px;\n      }\n\n      .widget-title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--text);\n        margin: 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .status-dot {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background: var(--danger);\n        transition: all 0.3s ease;\n      }\n\n      .status-dot.connected {\n        background: var(--success);\n        box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);\n        animation: pulse 2s ease-in-out infinite;\n      }\n\n      .status-dot.listening {\n        background: var(--primary);\n        animation: listening-pulse 1s ease-in-out infinite;\n      }\n\n      .status-dot.talking {\n        background: var(--warning);\n        animation: talking-pulse 0.5s ease-in-out infinite;\n      }\n\n      .minimize-btn {\n        width: 24px;\n        height: 24px;\n        border-radius: 6px;\n        border: none;\n        background: var(--surface);\n        color: var(--text-muted);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n        transition: all 0.2s ease;\n      }\n\n      .minimize-btn:hover {\n        background: var(--surface-hover);\n        color: var(--text);\n      }\n\n      .main-controls {\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n      }\n\n      .primary-action {\n        width: 100%;\n        height: 56px;\n        border-radius: 12px;\n        border: none;\n        font-size: 16px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 12px;\n        position: relative;\n        overflow: hidden;\n      }\n\n      .primary-action.start {\n        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);\n        color: white;\n      }\n\n      .primary-action.start:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);\n      }\n\n      .primary-action.active {\n        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);\n        color: white;\n      }\n\n      .primary-action.active:hover {\n        background: linear-gradient(135deg, #059669 0%, #047857 100%);\n      }\n\n      .secondary-controls {\n        display: flex;\n        gap: 8px;\n        justify-content: space-between;\n      }\n\n      .control-btn {\n        flex: 1;\n        height: 40px;\n        border-radius: 8px;\n        border: 1px solid var(--border);\n        background: var(--surface);\n        color: var(--text-muted);\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 6px;\n      }\n\n      .control-btn:hover {\n        background: var(--surface-hover);\n        color: var(--text);\n        border-color: rgba(255, 255, 255, 0.2);\n      }\n\n      .control-btn:disabled {\n        opacity: 0.4;\n        cursor: not-allowed;\n      }\n\n      .control-btn.danger {\n        border-color: rgba(239, 68, 68, 0.3);\n        color: var(--danger);\n      }\n\n      .control-btn.danger:hover {\n        background: rgba(239, 68, 68, 0.1);\n        border-color: var(--danger);\n      }\n\n      .features-row {\n        display: flex;\n        gap: 8px;\n        margin-top: 12px;\n      }\n\n      .feature-btn {\n        flex: 1;\n        height: 36px;\n        border-radius: 6px;\n        border: 1px solid var(--border);\n        background: transparent;\n        color: var(--text-muted);\n        font-size: 12px;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 4px;\n      }\n\n      .feature-btn:hover {\n        background: var(--surface);\n        color: var(--text);\n      }\n\n      .feature-btn.active {\n        background: rgba(99, 102, 241, 0.2);\n        border-color: var(--primary);\n        color: var(--primary);\n      }\n\n      .feature-btn:disabled {\n        opacity: 0.3;\n        cursor: not-allowed;\n      }\n\n      .audio-visualizer {\n        height: 40px;\n        background: rgba(0, 0, 0, 0.2);\n        border-radius: 8px;\n        margin: 16px 0 12px 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 2px;\n        padding: 8px;\n      }\n\n      .audio-bar {\n        width: 3px;\n        height: 4px;\n        background: rgba(255, 255, 255, 0.3);\n        border-radius: 2px;\n        transition: all 0.1s ease;\n      }\n\n      .audio-bar.active {\n        background: linear-gradient(to top, var(--primary), #a855f7);\n        box-shadow: 0 0 4px rgba(99, 102, 241, 0.5);\n      }\n\n      .status-text {\n        text-align: center;\n        font-size: 13px;\n        color: var(--text-muted);\n        margin-top: 12px;\n        min-height: 18px;\n      }\n\n      .voice-assistant-minimized {\n        width: 56px;\n        height: 56px;\n        border-radius: 16px;\n        background: rgba(17, 17, 27, 0.95);\n        backdrop-filter: blur(20px);\n        border: 1px solid var(--border);\n        box-shadow: var(--shadow);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.3s ease;\n        pointer-events: auto;\n        color: var(--text-muted);\n        font-size: 20px;\n      }\n\n      .voice-assistant-minimized:hover {\n        transform: scale(1.05);\n        background: rgba(17, 17, 27, 1);\n        color: var(--text);\n      }\n\n      .voice-assistant-minimized.active {\n        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);\n        color: white;\n        animation: pulse 2s ease-in-out infinite;\n      }\n\n      @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.8; }\n      }\n\n      @keyframes listening-pulse {\n        0%, 100% { opacity: 1; transform: scale(1); }\n        50% { opacity: 0.7; transform: scale(1.2); }\n      }\n\n      @keyframes talking-pulse {\n        0%, 100% { opacity: 1; transform: scale(1); }\n        50% { opacity: 0.8; transform: scale(1.3); }\n      }\n\n      /* Light theme */\n      .voice-assistant-container.theme-light {\n        --primary: #6366f1;\n        --primary-dark: #4f46e5;\n        --success: #059669;\n        --danger: #dc2626;\n        --warning: #d97706;\n        --surface: rgba(0, 0, 0, 0.05);\n        --surface-hover: rgba(0, 0, 0, 0.08);\n        --text: #1f2937;\n        --text-muted: #6b7280;\n        --border: rgba(0, 0, 0, 0.1);\n        --shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n      }\n\n      .voice-assistant-container.theme-light .voice-assistant-widget {\n        background: rgba(255, 255, 255, 0.95);\n      }\n\n      .voice-assistant-container.theme-light .voice-assistant-minimized {\n        background: rgba(255, 255, 255, 0.95);\n      }\n\n      /* Mobile responsive */\n      @media (max-width: 768px) {\n        .voice-assistant-widget {\n          width: 280px;\n          padding: 16px;\n        }\n        \n        .voice-assistant-container.position-bottom-right,\n        .voice-assistant-container.position-bottom-left {\n          bottom: 16px;\n        }\n        \n        .voice-assistant-container.position-bottom-right {\n          right: 16px;\n        }\n        \n        .voice-assistant-container.position-bottom-left {\n          left: 16px;\n        }\n      }\n    ",document.head.appendChild(t)}}createUI(){this.isMinimized?this.createMinimizedUI():this.createFullUI()}createFullUI(){this.container.innerHTML=`\n          <div class="voice-assistant-widget">\n            <div class="widget-header">\n              <h3 class="widget-title">\n                <div class="status-dot" id="status-dot"></div>\n                AI Assistant\n              </h3>\n              <button class="minimize-btn" id="minimize-btn" title="Minimize">—</button>\n            </div>\n            \n            <div class="audio-visualizer" id="audio-visualizer">\n              ${Array(16).fill(0).map((t,e)=>`<div class="audio-bar" data-bar="${e}"></div>`).join("")}\n            </div>\n            \n            <div class="main-controls">\n              <button class="primary-action start" id="primary-action">\n                <span id="action-icon">🎤</span>\n                <span id="action-text">Start Conversation</span>\n              </button>\n              \n              <div class="secondary-controls">\n                <button class="control-btn" id="pause-btn" disabled>\n                  <span>⏸️</span>\n                  Pause\n                </button>\n                <button class="control-btn danger" id="stop-btn" disabled>\n                  <span>⏹️</span>\n                  Stop\n                </button>\n              </div>\n            </div>\n            \n            ${this.createFeatureButtons()}\n            \n            <div class="status-text" id="status-text">${this.statusText}</div>\n          </div>\n        `,this.setupEventListeners()}createFeatureButtons(){if(!this.features.video&&!this.features.screenShare&&!this.features.fileUpload)return"";let t="";return this.features.video&&(t+='\n            <button class="feature-btn" id="video-btn" disabled>\n              <span>📹</span>\n              Video\n            </button>\n          '),this.features.screenShare&&(t+='\n            <button class="feature-btn" id="screen-btn" disabled>\n              <span>🖥️</span>\n              Screen\n            </button>\n          '),this.features.fileUpload&&(t+='\n            <button class="feature-btn" id="file-btn" disabled>\n              <span>📎</span>\n              File\n            </button>\n          '),`<div class="features-row">${t}</div>`}createMinimizedUI(){this.container.innerHTML=`\n          <div class="voice-assistant-minimized ${this.isConnected?"active":""}" id="minimized-widget" title="AI Assistant">\n            ${this.isListening?"🎤":"🤖"}\n          </div>\n        `,this.container.querySelector("#minimized-widget").addEventListener("click",()=>{this.isMinimized=!1,this.createUI()})}setupEventListeners(){const t=this.container.querySelector("#primary-action"),e=this.container.querySelector("#pause-btn"),n=this.container.querySelector("#stop-btn"),i=this.container.querySelector("#minimize-btn"),s=this.container.querySelector("#video-btn"),o=this.container.querySelector("#screen-btn"),a=this.container.querySelector("#file-btn");t?.addEventListener("click",()=>{this.isConnected||this.startSession()}),e?.addEventListener("click",()=>{this.pauseSession()}),n?.addEventListener("click",()=>{this.stopSession()}),i?.addEventListener("click",()=>{this.isMinimized=!0,this.createUI()}),s?.addEventListener("click",()=>{this.toggleVideo()}),o?.addEventListener("click",()=>{this.toggleScreenShare()}),a?.addEventListener("click",()=>{this.openFileUpload()})}setupAudioVisualizer(){this.visualizerInterval=setInterval(()=>{const t=this.container.querySelectorAll(".audio-bar");t.length&&t.forEach((t,e)=>{if(this.isListening&&this.volume>0){const e=Math.min(24,4+200*this.volume*(.5+.5*Math.random()));t.style.height=`${e}px`,t.classList.add("active")}else if(this.isTalking){const e=4+20*Math.random();t.style.height=`${e}px`,t.classList.add("active")}else t.style.height="4px",t.classList.remove("active")})},100)}startSession(){this.onStartSession&&this.onStartSession()}pauseSession(){this.isPaused=!this.isPaused,this.onPauseSession&&this.onPauseSession(this.isPaused),this.updateUI()}stopSession(){this.onStopSession&&this.onStopSession()}toggleVideo(){this.onToggleVideo&&this.onToggleVideo()}toggleScreenShare(){this.onToggleScreenShare&&this.onToggleScreenShare()}openFileUpload(){const t=document.createElement("input");t.type="file",t.accept="image/*,audio/*,video/*,.pdf,.txt,.docx",t.onchange=t=>{const e=t.target.files[0];e&&this.onFileUpload&&this.onFileUpload(e)},t.click()}updateConnectionStatus(t){this.isConnected=t,this.updateUI()}updateListeningStatus(t){this.isListening=t,this.updateUI()}updateTalkingStatus(t){this.isTalking=t,this.updateUI()}updateVolume(t){this.volume=t}updateStatus(t){this.statusText=t;const e=this.container.querySelector("#status-text");e&&(e.textContent=t)}updateUI(){const t=this.container.querySelector("#status-dot"),e=this.container.querySelector("#primary-action"),n=this.container.querySelector("#action-icon"),i=this.container.querySelector("#action-text"),s=this.container.querySelector("#pause-btn"),o=this.container.querySelector("#stop-btn"),a=this.container.querySelector("#video-btn"),r=this.container.querySelector("#screen-btn"),c=this.container.querySelector("#file-btn");t&&(t.className="status-dot",this.isConnected&&(this.isTalking?t.classList.add("talking"):this.isListening?t.classList.add("listening"):t.classList.add("connected"))),e&&n&&i&&(this.isConnected?(e.className="primary-action active",this.isPaused?(n.textContent="▶️",i.textContent="Resume"):this.isListening?(n.textContent="🔴",i.textContent="Listening..."):this.isTalking?(n.textContent="🔊",i.textContent="Speaking..."):(n.textContent="✅",i.textContent="Connected")):(e.className="primary-action start",n.textContent="🎤",i.textContent="Start Conversation")),s&&(s.disabled=!this.isConnected,s.innerHTML=this.isPaused?"<span>▶️</span>Resume":"<span>⏸️</span>Pause"),o&&(o.disabled=!this.isConnected),[a,r,c].forEach(t=>{t&&(t.disabled=!this.isConnected)});let d="";d=this.isConnected?this.isPaused?"Session paused":this.isTalking?"AI is speaking...":this.isListening?"Listening to your voice...":"Connected and ready":"Ready to start conversation",this.updateStatus(d)}destroy(){this.visualizerInterval&&clearInterval(this.visualizerInterval),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}class VoiceAssistant{constructor(){this.client=null,this.audioRecorder=null,this.audioStreamer=null,this.ui=null,this.config={backendUrl:"ws://aiagent.babaai.live",model:"models/gemini-2.0-flash-exp",theme:"theme-dark",position:"bottom-right",voiceName:"Aoede",apiKey:null,features:{video:!1,screenShare:!1,fileUpload:!1},websiteContext:null},this.connected=!1,this.muted=!0,this.volume=0,this.isTalking=!1,this.sessionStartTime=null}async init(t={}){this.config={...this.config,...t,features:{...this.config.features,...t.features}},this.client=new s(this.config.backendUrl,this.config.apiKey),this.audioRecorder=new o;try{const t=await e.audioContext({id:"voice-assistant-audio"});this.audioStreamer=new a(t),await this.audioStreamer.addWorklet("vumeter-out",i,t=>{this.volume=t.data.volume,this.ui?.updateVolume(this.volume)})}catch(t){console.error("Failed to initialize audio:",t)}this.ui=new r(this.config),this.setupEventHandlers(),console.log("Voice Assistant initialized successfully")}setupEventHandlers(){this.client.on("open",()=>{this.connected=!0,this.ui?.updateConnectionStatus(!0),console.log("Connected to voice assistant")}),this.client.on("close",()=>{this.connected=!1,this.ui?.updateConnectionStatus(!1),this.stopAudioRecording(),console.log("Disconnected from voice assistant")}),this.client.on("audio",t=>{this.isTalking=!0,this.ui?.updateTalkingStatus(!0),this.audioStreamer?.addPCM16(new Uint8Array(t))}),this.client.on("interrupted",()=>{this.audioStreamer?.stop(),this.isTalking=!1,this.ui?.updateTalkingStatus(!1)}),this.client.on("turncomplete",()=>{this.isTalking=!1,this.ui?.updateTalkingStatus(!1)}),this.audioRecorder.on("data",t=>{this.ui?.isPaused||this.client.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:t}])}),this.audioRecorder.on("volume",t=>{!1===this.muted&&this.ui?.updateVolume(t)}),this.audioStreamer&&(this.audioStreamer.onComplete=()=>{this.isTalking=!1,this.ui?.updateTalkingStatus(!1)}),this.ui.onStartSession=()=>{this.startSession()},this.ui.onStopSession=()=>{this.stopSession()},this.ui.onPauseSession=t=>{t?this.audioStreamer?.stop():this.audioStreamer?.resume()},this.ui.onToggleVideo=()=>{console.log("Video toggle requested")},this.ui.onToggleScreenShare=()=>{console.log("Screen share toggle requested")},this.ui.onFileUpload=t=>{console.log("File upload:",t)}}async startSession(){if(this.connected||!this.client)return;this.sessionStartTime=Date.now();let t="You are a helpful AI voice assistant. Respond naturally and conversationally. and your name is scarllet. the baba ai(بابا ای آی) created you. babaai is a toronto based company.";if(this.config.websiteContext){const e=this.config.websiteContext;e.name&&(t+=` You are helping users on the website "${e.name}".`),e.description&&(t+=` ${e.description}`),e.customInstructions&&(t+=` ${e.customInstructions}`)}const e={responseModalities:["AUDIO"],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:this.config.voiceName}}},systemInstruction:{parts:[{text:t}]}};try{await this.client.connect(this.config.model,e)?setTimeout(()=>{this.startAudioRecording()},500):console.error("Failed to connect via client")}catch(t){console.error("Failed to connect:",t)}}stopSession(){this.connected&&this.client&&(this.stopAudioRecording(),this.client.disconnect(),this.sessionStartTime=null)}async startAudioRecording(){if(this.audioRecorder&&this.connected)try{await this.audioRecorder.start(),this.muted=!1,this.ui?.updateListeningStatus(!0)}catch(t){console.error("Failed to start audio recording:",t)}}stopAudioRecording(){this.audioRecorder&&(this.audioRecorder.stop(),this.muted=!0,this.ui?.updateListeningStatus(!1))}destroy(){this.stopSession(),this.ui?.destroy(),this.audioStreamer&&this.audioStreamer.stop()}setConfig(t){this.config={...this.config,...t,features:{...this.config.features,...t.features}}}getStatus(){return{connected:this.connected,muted:this.muted,volume:this.volume,talking:this.isTalking,paused:this.ui?.isPaused||!1,hasVideo:!1,features:this.config.features}}}t.VoiceAssistant={instance:null,init(t={}){return this.instance&&(console.warn("Voice Assistant already initialized. Destroying previous instance."),this.destroy()),this.instance=new VoiceAssistant,this.instance.init(t),this.instance},quickStart(t={}){const e=this.init(t);return setTimeout(()=>{e.startSession()},500),e},enableFeatures(t){this.instance&&(this.instance.setConfig({features:t}),this.instance.ui.features={...this.instance.ui.features,...t},this.instance.ui.createUI())},setWebsiteContext(t){this.instance&&this.instance.setConfig({websiteContext:t})},destroy(){this.instance&&(this.instance.destroy(),this.instance=null)},getInstance(){return this.instance},startSession(){return this.instance?.startSession()},stopSession(){return this.instance?.stopSession()},pauseSession(){return this.instance?.ui?.pauseSession()},getStatus(){return this.instance?.getStatus()||{connected:!1,muted:!0,paused:!1,volume:0,talking:!1,hasVideo:!1,features:{video:!1,screenShare:!1,fileUpload:!1}}},setTheme(t){this.instance&&(this.instance.setConfig({theme:t}),this.instance.ui.container.className=this.instance.ui.container.className.replace(/theme-\w+/,t))},setPosition(t){this.instance&&(this.instance.setConfig({position:t}),this.instance.ui.container.className=this.instance.ui.container.className.replace(/position-[\w-]+/,`position-${t}`))},getAnalytics(){if(!this.instance)return{isActive:!1,sessionDuration:0,featuresUsed:[],currentState:"destroyed"};const t=this.getStatus();return{isActive:t.connected,sessionDuration:this.instance.sessionStartTime?Date.now()-this.instance.sessionStartTime:0,featuresUsed:Object.keys(t.features).filter(e=>t.features[e]),currentState:t.talking?"talking":t.connected&&!t.muted?"listening":t.connected?"connected":"disconnected"}}},t.VoiceAssistant.autoInit=function(t="[data-voice-assistant]"){document.querySelectorAll(t).forEach(t=>{const e={backendUrl:t.dataset.backendUrl||"ws://localhost:8080",theme:t.dataset.theme||"theme-dark",position:t.dataset.position||"bottom-right",voiceName:t.dataset.voice||"Aoede",features:{video:"true"===t.dataset.video,screenShare:"true"===t.dataset.screenShare,fileUpload:"true"===t.dataset.fileUpload}};this.init(e)})},t.VoiceAssistant.wordpress={init(e={}){const n={websiteContext:{name:document.title,description:document.querySelector('meta[name="description"]')?.content||"",purpose:"WordPress website assistance",customInstructions:"Help users navigate this WordPress website, find content, and answer questions about the site."},...e};return t.VoiceAssistant.init(n)}},t.VoiceAssistant.ecommerce={init(e={}){const n={features:{video:!0,fileUpload:!0,...e.features},websiteContext:{name:document.title,purpose:"E-commerce shopping assistance",customInstructions:"Help customers find products, answer questions about items, assist with orders, and provide shopping guidance. You can view images of products if customers share them.",...e.websiteContext},...e};return t.VoiceAssistant.init(n)}},t.VoiceAssistant.education={init(e={}){const n={features:{video:!0,screenShare:!0,fileUpload:!0,...e.features},websiteContext:{purpose:"Educational assistance",customInstructions:"Help students with learning, answer academic questions, assist with assignments, and provide educational guidance. You can review documents and images that students share.",...e.websiteContext},...e};return t.VoiceAssistant.init(n)}},document.addEventListener("DOMContentLoaded",()=>{document.querySelector("[data-voice-assistant]")&&t.VoiceAssistant.autoInit()}),console.log("Enhanced Voice Assistant Bundle loaded successfully"),console.log("🎤 Features: Modern UI, One-click start, Video/Screen sharing, File upload"),console.log('🚀 Quick start: VoiceAssistant.quickStart({ backendUrl: "ws://your-server.com" })')}(window);